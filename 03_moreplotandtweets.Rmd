# Big-Data Lab (January 30): More plotting practice and beginning with Twitter data



## Objectives of this lab

This tutorial will cover the following:

* Practice more plots in ggplot;
* Practice ggplots using the public health dataframe (`obesity_cov_2013`) from previous lab.
* Begin to use Twitter data – from an archived dataset
* If you want to access Twitter API yourself (not required), you’ll need your Twitter account (see below).

The R functions in this lab program should:

* Find the maximum number of pages to be queried
* Generate all the subpages that make up the reviews
* Scrape the information from each of them
* Combine the information into one comprehensive data frame





## R CODE FOR TWITTER ASSIGNMENT

PACKAGES
```{r}
library(ggplot2)
```


## Packages for Twitter exercise 
You will need to install some of them first 

```{r}
library(tidyverse)
library(lubridate)
```



## Exploring ggplot

```{r}
ggplot(data = diamonds) + geom_bar(mapping = aes(x=cut))
ggplot(data = diamonds) + geom_bar(mapping = aes(x=cut, color=cut))
ggplot(data = diamonds) + geom_bar(mapping = aes(x=cut, fill=cut))
ggplot(data = diamonds) + geom_bar(mapping = aes(x=cut, fill = clarity), position = "dodge")
# careful with parentheses above

ggplot(mpg, aes(class, hwy)) + geom_boxplot()

```



## MORE PRACTICE GGPLOT ON OBESITY AND COVARIATES 

Here  you will need to use data frame from obesity lab: `obesity_cov_2013` (you may have to read it again. Feel free to include results on your assignment.

```{r}
ggplot(data = obesity_cov_2013) + geom_boxplot(aes(State.1,Income))
ggplot(data = obesity_cov_2013) + geom_boxplot(aes(State.1,Obes__aa))
```

Replace x-axis label

```{r}
ggplot(data = obesity_cov_2013) + geom_boxplot(aes(State.1,Income))+xlab("State")
```

Or just remove x-axis label

```{r}
ggplot(data = obesity_cov_2013) + geom_boxplot(aes(State.1,Income))+xlab("")
```

Too many states on the on x-axis?  Try rotating the boxplot: with `coord_flip()`

```{r}
ggplot(data = obesity_cov_2013) + geom_boxplot(aes(State.1,Income))+coord_flip()
```

 Notice that the states are still addressed by `xlab()` when using `coord_flip()`

 Want average values for each state? 
Get mean value of columns 7 through 13 for each state with this command

```{r}
States_2013 <- aggregate(obesity_cov_2013[, 7:11], list(State = obesity_cov_2013$State.1), mean)
```

 `States_2013` now has  values averaged across counties (not population) for each state. Is it useful? Note that a boxplot of these state-averaged data shows much less!


## BEGINNING WITH TWITTER DATASET

If you want to access Twitter API yourself (not required), you’ll need your Twitter account and create an app to get developper access to twitter API.
To do so, once you are connected with your account (or one done for the occasion) 
you can go to [twitter API](https://developer.twitter.com/apps)


![](images/creatApp.png)

In your words:
```
For the class "Big Data for Social Scientist, at the University of Tennessee Knoxville, we want to create an app to interact with the twitter API.  This will allow us  to generate and explore a simple data set, and learn about methods to do so with R.  
```

## Usefull PACKAGES
```{r}
library(tidyverse)
install.packages("tidytext")
library(tidytext)
install.packages("lubridate")
library(lubridate)
install.packages("stringr")
library(stringr)
install.packages("tidyr")
library(tidyr)
```

LOAD DATA SET (CHOOSE ONE) If you’re interested in the full 350MB dataset, let us know….
NBC dataset (smaller, best for in-class exercise):
```{r}
tweets <- read.csv("data/streamlined_tweets.csv")
```

LOOK AT this DATAFRAME
```{r}
head(tweets)
view(tweets)
```

FORMAT TIME STAMPS NBC:

```{r}
tweets_dated <- tweets %>% mutate(Date = mdy_hm(Date))
```

PLOT VOLUME OF TWEETS OVER TIME
By bin:
```{r}
ggplot(data = tweets_dated, aes(x=Date)) + geom_freqpoly(bins = 859)
```
Cumulative:
```{r}
ggplot(data = tweets_dated, aes(x=Date)) + geom_histogram(aes(y=cumsum(..count..)), bins=859)
```


RIBBON PLOT OF TWITTER NAMES OVER TIME
```{r,eval=F}
tweets_dated %>%   
mutate(Twitter_Name = fct_lump(Twitter_Name, 20)) %>%    
count( Date = round_date(Date, "month"), Twitter_Name) %>%  
complete(month, Twitter_Name, fill = list(n = 0)) %>%
mutate(Twitter_Name = reorder(Twitter_Name, -n, sum)) %>% 
group_by(month) %>%  
mutate(percent = n /sum(n), maximum = cumsum(percent),  minimum = lag(maximum, 1, 0)) %>%  
ggplot(aes(month, ymin = minimum, ymax = maximum, fill = Twitter_Name)) + geom_ribbon()
```


You will need to install `twitteR` package and load it:

```{r}
install.packages("twitteR")
library(twitteR)
```

```{r, include=F,eval=F,echo=FALSE}
#to get your consumerKey and consumerSecret see the twitteR documentation for instructions
consumer_key <- 'sHpzxLvtUar6TiQ4kBVsOnFFg'
consumer_secret <- 'Rf6uBiU9KAdGy6i1Vq9J52aCsDvQbb7IheL13MZMqDr7EI2lWL'
access_token <- '1171319695-6XxSMofnmLtnhXnlVXisVPw4v64smQjzdL8cygZ'
access_secret <- '6cbJ99RinAm6UyP8g6S5RjzmANio3DgfVKLyREVuim1wP'
setup_twitter_oauth(consumer_key,
                    consumer_secret,
                    access_token,
                    access_secret)
```

```{r ,eval=FALSE}
#to get your consumerKey and consumerSecret see the twitteR documentation for instructions
consumer_key <- 'your key'
consumer_secret <- 'your secret'
access_token <- 'your access token'
access_secret <- 'your access secret'
setup_twitter_oauth(consumer_key,
                    consumer_secret,
                    access_token,
                    access_secret)
```

```{r,include=F}
load(file="bin/govols.bin")
```

We first look for all tweet with the hashtag [#GoVols](https://twitter.com/search?q=GoVols&f=live)

```{r,eval=F}
govols <- searchTwitter("#GoVols", n=3000)
```

Then we extract the date of the tweet store it in a vector: 

```{r}
alldates=sapply(govols,function(l)format(l$created,"%D-%I%p"))
```

As we formated the tweets in a way that only the days and the hours are used, we can count how many tweets we have for all those days and hours and plot it:

```{r}
counttweets=table(alldates)
plot(counttweets,ylab="Number of tweets",xlab="Date",type="l" )
```




